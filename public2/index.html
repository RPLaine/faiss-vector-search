<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Journalist Agents - Live Demo</title>
    <link rel="stylesheet" href="/css/main.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <h1 class="app-title" data-i18n="app.title">AI Journalist Agents</h1>
                    <div class="connection-status">
                        <span class="status-indicator" id="statusIndicator"></span>
                        <span class="status-text" id="statusText" data-i18n="connection.connecting">Connecting...</span>
                    </div>
                </div>
                <div class="header-center">
                    <div class="control-group">
                        <button type="button" id="addAgentBtn" class="btn btn-primary">
                            <span class="btn-icon">+</span>
                            <span class="btn-text" data-i18n="header.create_agent">Create New Agent</span>
                        </button>
                        <button type="button" id="clearCompletedBtn" class="btn btn-secondary">
                            <span class="btn-icon">üóë</span>
                            <span class="btn-text" data-i18n="header.clear_completed">Clear Completed</span>
                        </button>
                        <button type="button" id="settingsBtn" class="btn btn-secondary" title="Settings">
                            <span class="btn-icon">‚öôÔ∏è</span>
                            <span class="btn-text" data-i18n="header.settings">Settings</span>
                        </button>
                    </div>
                </div>
                <div class="header-right">
                    <div class="agent-stats">
                        <span class="stat-item">
                            <span class="stat-label" data-i18n="header.stats.active">Active:</span>
                            <span class="stat-value" id="activeCount">0</span>
                        </span>
                        <span class="stat-item">
                            <span class="stat-label" data-i18n="header.stats.completed">Completed:</span>
                            <span class="stat-value" id="completedCount">0</span>
                        </span>
                        <span class="stat-item">
                            <span class="stat-label" data-i18n="header.stats.total">Total:</span>
                            <span class="stat-value" id="totalCount">0</span>
                        </span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Agent Node Controls Panel (affects selected agent) -->
        <div id="agentNodeControls" class="agent-node-controls-panel hidden">
            <div class="controls-panel-content">
                <div class="controls-panel-left">
                    <button type="button" class="btn btn-primary btn-action" id="controlPanelAction" disabled>
                        <span class="btn-icon">‚ñ∂Ô∏è</span>
                        <span class="btn-text" data-i18n="control_panel.start">Start</span>
                    </button>
                    <button type="button" class="btn btn-primary btn-continue" id="controlPanelContinue" style="display: none;" disabled>
                        <span class="btn-icon">‚è©</span>
                        <span class="btn-text" data-i18n="control_panel.continue">Continue</span>
                    </button>
                    <button type="button" class="btn btn-secondary btn-edit" id="controlPanelEdit" disabled>
                        <span class="btn-icon">‚úèÔ∏è</span>
                        <span class="btn-text" data-i18n="control_panel.edit">Edit</span>
                    </button>
                    <button type="button" class="btn btn-secondary btn-delete" id="controlPanelDelete" disabled>
                        <span class="btn-icon">üóëÔ∏è</span>
                        <span class="btn-text" data-i18n="control_panel.delete">Delete</span>
                    </button>
                </div>
                <div class="controls-panel-right">
                    <label class="auto-control">
                        <input type="checkbox" class="auto-checkbox" id="controlPanelAuto" disabled>
                        <span data-i18n="control_panel.auto">Auto</span>
                    </label>
                    <label class="auto-control halt-control" id="controlPanelHaltLabel" style="display: none;">
                        <input type="checkbox" class="halt-checkbox" id="controlPanelHalt" disabled>
                        <span data-i18n="control_panel.halt">Halt</span>
                    </label>
                    <label class="auto-control">
                        <input type="checkbox" class="expand-checkbox" id="controlPanelExpand" disabled>
                        <span data-i18n="control_panel.expand">Expand</span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Agent Grid -->
        <div class="agents-grid" id="agentsGrid">
            <canvas id="agentCanvas"></canvas>
            <!-- SVG layer for connection lines (behind nodes) -->
            <svg id="connectionLines" class="connection-lines"></svg>
            <!-- Agent detail cards will overlay on canvas -->
            <div id="agentNodesContainer"></div>
        </div>
    </div>

    <!-- Create Agent Modal -->
    <div class="modal" id="createAgentModal">
        <div class="modal-overlay" onclick="closeCreateAgentModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Create AI Journalist Agent</h2>
                <button type="button" class="modal-close" onclick="closeCreateAgentModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="agentName" class="form-label">Agent Name</label>
                    <input 
                        type="text" 
                        id="agentName" 
                        class="form-input" 
                        placeholder="e.g., Tech Reporter, Sports Columnist"
                    >
                </div>
                <div class="form-group">
                    <label for="agentContext" class="form-label">Additional Context (Optional)</label>
                    <textarea 
                        id="agentContext" 
                        class="form-textarea" 
                        rows="3" 
                        placeholder="e.g., Focus on recent developments, Interview tech experts, Use data from Q4 2024"
                    ></textarea>
                    <div class="form-hint">
                        Provide guidance or constraints for the journalist. The agent will invent its own subject.
                    </div>
                </div>
                <div class="form-group">
                    <label for="agentTemperature" class="form-label">
                        Creativity (Temperature: <span id="tempValue">0.3</span>)
                    </label>
                    <input 
                        type="range" 
                        id="agentTemperature" 
                        class="form-range" 
                        min="0" 
                        max="1" 
                        step="0.1" 
                        value="0.3"
                        oninput="document.getElementById('tempValue').textContent = this.value"
                    >
                    <div class="form-hint">
                        Lower values = more focused, Higher values = more creative
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeCreateAgentModal()">Cancel</button>
                <button type="submit" class="btn btn-primary" id="createAgentSubmit">Create</button>
            </div>
        </div>
    </div>

    <!-- Edit Agent Modal -->
    <div class="modal" id="editAgentModal">
        <div class="modal-overlay" onclick="closeEditAgentModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Edit AI Journalist Agent</h2>
                <button type="button" class="modal-close" onclick="closeEditAgentModal()">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editAgentId">
                <div class="form-group">
                    <label for="editAgentName" class="form-label">Agent Name</label>
                    <input 
                        type="text" 
                        id="editAgentName" 
                        class="form-input" 
                        placeholder="e.g., Tech Reporter, Sports Columnist"
                    >
                </div>
                <div class="form-group">
                    <label for="editAgentContext" class="form-label">Additional Context (Optional)</label>
                    <textarea 
                        id="editAgentContext" 
                        class="form-textarea" 
                        rows="3" 
                        placeholder="e.g., Focus on recent developments, Interview tech experts, Use data from Q4 2024"
                    ></textarea>
                    <div class="form-hint">
                        Provide guidance or constraints for the journalist.
                    </div>
                </div>
                <div class="form-group">
                    <label for="editAgentTemperature" class="form-label">
                        Creativity (Temperature: <span id="editTempValue">0.3</span>)
                    </label>
                    <input 
                        type="range" 
                        id="editAgentTemperature" 
                        class="form-range" 
                        min="0" 
                        max="1" 
                        step="0.1" 
                        value="0.3"
                        oninput="document.getElementById('editTempValue').textContent = this.value"
                    >
                    <div class="form-hint">
                        Lower values = more focused, Higher values = more creative
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeEditAgentModal()">Cancel</button>
                <button type="submit" class="btn btn-primary" id="editAgentSubmit">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 class="modal-title" data-i18n="modal.settings.title">System Settings</h2>
                <button type="button" class="modal-close" id="closeSettingsBtn">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Language Selector -->
                <div class="form-group">
                    <label for="languageSelect" class="form-label" data-i18n="modal.settings.language_label">Language</label>
                    <select id="languageSelect" class="form-input">
                        <option value="en" data-i18n="modal.settings.language_en">English</option>
                        <option value="fi" data-i18n="modal.settings.language_fi">Suomi (Finnish)</option>
                    </select>
                </div>
                
                <hr style="margin: 20px 0; border: 1px solid #ddd;">
                
                <!-- Tabs -->
                <div class="tabs">
                    <button class="tab-button active" data-tab="llm" data-i18n="modal.settings.tab_llm">LLM Configuration</button>
                    <button class="tab-button" data-tab="prompts" data-i18n="modal.settings.tab_prompts">Prompt Templates</button>
                    <button class="tab-button" data-tab="retrieval" data-i18n="modal.settings.tab_retrieval">Retrieval (FAISS)</button>
                </div>

                <!-- LLM Configuration Tab -->
                <div class="tab-content active" id="llmTab">
                    <div class="form-group">
                        <label for="llmUrl" class="form-label">LLM Server URL</label>
                        <input 
                            type="text" 
                            id="llmUrl" 
                            class="form-input" 
                            placeholder="https://api.example.com/v1/chat/completions"
                        >
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="llmModel" class="form-label">Model</label>
                            <input 
                                type="text" 
                                id="llmModel" 
                                class="form-input" 
                                placeholder="qwen"
                            >
                        </div>
                        <div class="form-group">
                            <label for="llmPayloadType" class="form-label">Payload Type</label>
                            <select id="llmPayloadType" class="form-input">
                                <option value="message">Message</option>
                                <option value="completion">Completion</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="llmTimeout" class="form-label">Timeout (seconds)</label>
                            <input 
                                type="number" 
                                id="llmTimeout" 
                                class="form-input" 
                                min="1"
                                placeholder="300"
                            >
                        </div>
                        <div class="form-group">
                            <label for="llmMaxTokens" class="form-label">Max Tokens</label>
                            <input 
                                type="number" 
                                id="llmMaxTokens" 
                                class="form-input" 
                                min="1"
                                placeholder="2000"
                            >
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="llmTemperature" class="form-label">
                                Temperature: <span id="llmTempValue">0.3</span>
                            </label>
                            <input 
                                type="range" 
                                id="llmTemperature" 
                                class="form-range" 
                                min="0" 
                                max="2" 
                                step="0.1" 
                                value="0.3"
                            >
                        </div>
                        <div class="form-group">
                            <label for="llmTopP" class="form-label">
                                Top P: <span id="llmTopPValue">0.90</span>
                            </label>
                            <input 
                                type="range" 
                                id="llmTopP" 
                                class="form-range" 
                                min="0" 
                                max="1" 
                                step="0.01" 
                                value="0.90"
                            >
                        </div>
                        <div class="form-group">
                            <label for="llmTopK" class="form-label">Top K</label>
                            <input 
                                type="number" 
                                id="llmTopK" 
                                class="form-input" 
                                min="1"
                                placeholder="20"
                            >
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Custom Headers</label>
                        <div id="headersContainer" class="headers-container">
                            <!-- Headers will be dynamically added here -->
                        </div>
                        <button type="button" class="btn btn-secondary btn-small" id="addHeaderBtn">
                            <span class="btn-icon">+</span>
                            Add Header
                        </button>
                    </div>
                </div>

                <!-- Prompts Tab -->
                <div class="tab-content" id="promptsTab">
                    <div class="form-group">
                        <label for="promptHiddenContext" class="form-label">Hidden Context</label>
                        <textarea 
                            id="promptHiddenContext" 
                            class="form-textarea code-editor" 
                            rows="8"
                            placeholder="System-wide instructions for AI behavior..."
                        ></textarea>
                        <div class="form-hint">System-wide instructions added to all LLM calls</div>
                    </div>
                    <div class="form-group">
                        <label for="promptPlanning" class="form-label">Tasklist Planning Prompt</label>
                        <textarea 
                            id="promptPlanning" 
                            class="form-textarea code-editor" 
                            rows="10"
                            placeholder="Template for generating agent tasklists..."
                        ></textarea>
                        <div class="form-hint">Required variables: {agent_name}, {agent_context}</div>
                    </div>
                    <div class="form-group">
                        <label for="promptTaskExecution" class="form-label">Task Execution Prompt</label>
                        <textarea 
                            id="promptTaskExecution" 
                            class="form-textarea code-editor" 
                            rows="8"
                            placeholder="Template for executing individual tasks..."
                        ></textarea>
                        <div class="form-hint">Required variables: {agent_name}, {goal}, {task_name}, {task_description}, {expected_output}, {context}</div>
                    </div>
                    <div class="form-group">
                        <label for="promptTaskValidation" class="form-label">Task Validation Prompt</label>
                        <textarea 
                            id="promptTaskValidation" 
                            class="form-textarea code-editor" 
                            rows="8"
                            placeholder="Template for validating task outputs..."
                        ></textarea>
                        <div class="form-hint">Required variables: {task_name}, {task_description}, {expected_output}, {actual_output}</div>
                    </div>
                </div>

                <!-- Retrieval Configuration Tab -->
                <div class="tab-content" id="retrievalTab">
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="retrievalEnabled" class="form-checkbox">
                            Enable FAISS Retrieval
                        </label>
                        <div class="form-hint">When enabled, tasks will retrieve relevant documents before LLM execution</div>
                    </div>

                    <div class="retrieval-settings" id="retrievalSettings">
                        <div class="form-group">
                            <label for="retrievalModel" class="form-label">Embedding Model</label>
                            <input 
                                type="text" 
                                id="retrievalModel" 
                                class="form-input" 
                                placeholder="TurkuNLP/sbert-cased-finnish-paraphrase"
                                readonly
                            >
                            <div class="form-hint">Sentence transformer model for generating embeddings</div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="retrievalHitTarget" class="form-label">Hit Target</label>
                                <input 
                                    type="number" 
                                    id="retrievalHitTarget" 
                                    class="form-input" 
                                    min="1"
                                    max="20"
                                    placeholder="3"
                                >
                                <div class="form-hint">Stop searching when this many documents found</div>
                            </div>
                            <div class="form-group">
                                <label for="retrievalTopK" class="form-label">Top K</label>
                                <input 
                                    type="number" 
                                    id="retrievalTopK" 
                                    class="form-input" 
                                    min="1"
                                    max="50"
                                    placeholder="10"
                                >
                                <div class="form-hint">Maximum documents to return</div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="retrievalThresholdStep" class="form-label">
                                    Threshold Step: <span id="retrievalThresholdStepValue">0.05</span>
                                </label>
                                <input 
                                    type="range" 
                                    id="retrievalThresholdStep" 
                                    class="form-range" 
                                    min="0.01" 
                                    max="0.2" 
                                    step="0.01" 
                                    value="0.05"
                                >
                                <div class="form-hint">Amount to decrease threshold each iteration</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">
                                    <input type="checkbox" id="retrievalDynamicThreshold" class="form-checkbox">
                                    Use Dynamic Threshold
                                </label>
                                <div class="form-hint">Automatically adjust threshold until hit_target reached</div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="retrievalMaxContext" class="form-label">Max Context Length</label>
                            <input 
                                type="number" 
                                id="retrievalMaxContext" 
                                class="form-input" 
                                min="100"
                                max="20000"
                                placeholder="5000"
                            >
                            <div class="form-hint">Maximum characters from retrieved documents to include in prompt</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="retrievalStoreOutputs" class="form-checkbox">
                                Store Task Outputs in Index
                            </label>
                            <div class="form-hint">Add completed task outputs to knowledge base for future retrieval</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Index Statistics</label>
                            <div id="retrievalStats" class="retrieval-stats">
                                <p>Loading...</p>
                            </div>
                        </div>

                        <div class="form-group">
                            <button type="button" class="btn btn-secondary" id="rebuildIndexBtn">Rebuild Index from data2/</button>
                            <div class="form-hint">Rebuilds FAISS index from all .txt files in data2/ directory</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="resetSettingsBtn">Reset to Defaults</button>
                <button type="button" class="btn btn-secondary" id="cancelSettingsBtn">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveSettingsBtn">Save Settings</button>
            </div>
        </div>
    </div>

    <!-- Refactored Architecture - Phase 2 -->
    <script type="module" src="/js/app.js"></script>
</body>
</html>
